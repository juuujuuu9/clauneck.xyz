const Q="modulepreload",Z=function(t){return"/"+t},N={},z=function(s,h,e){let c=Promise.resolve();if(h&&h.length>0){let l=function(p){return Promise.all(p.map(M=>Promise.resolve(M).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),g=r?.nonce||r?.getAttribute("nonce");c=l(h.map(p=>{if(p=Z(p),p in N)return;N[p]=!0;const M=p.endsWith(".css"),v=M?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${v}`))return;const d=document.createElement("link");if(d.rel=M?"stylesheet":Q,M||(d.as="script"),d.crossOrigin="",d.href=p,g&&d.setAttribute("nonce",g),document.head.appendChild(d),M)return new Promise((w,T)=>{d.addEventListener("load",w),d.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${p}`)))})}))}function f(l){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=l,window.dispatchEvent(r),!r.defaultPrevented)throw l}return c.then(l=>{for(const r of l||[])r.status==="rejected"&&f(r.reason);return s().catch(f)})};async function x(t){const s=await fetch("/api/hash",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:t})});if(!s.ok){let e="Failed to hash input",c="";try{const l=s.headers.get("content-type");if(l&&l.includes("application/json")){const r=await s.json();e=r.error||r.message||e,r.details&&(c=`: ${r.details}`),r.name&&(c+=` (${r.name})`)}else{const r=await s.text();c=r?`: ${r.substring(0,200)}`:""}}catch(l){c=`: ${s.status} ${s.statusText}`,console.error("Error parsing error response:",l)}const f=e+c;throw console.error("API Error:",f),new Error(f)}return(await s.json()).hash}function tt(t){const s=[];for(let h=0;h<8;h++){let c=parseInt(t.substring(h*8,(h+1)*8),16)||1;s.push(()=>(c=Math.imul(1597334677,c)>>>0,c/4294967296))}return s}function et(t){return{matrix:parseInt(t.substring(0,8),16)||1,symmetry:parseInt(t.substring(8,16),16)||1,iterations:parseInt(t.substring(16,24),16)||1,color:parseInt(t.substring(24,32),16)||1,noise:parseInt(t.substring(32,40),16)||1,structure:parseInt(t.substring(40,48),16)||1}}function ot(t){const s=t.getContext("2d");if(!s)return null;const h=window.devicePixelRatio||1,e=t.style.display==="none"||t.style.visibility==="hidden";e&&(t.style.display,t.style.visibility,t.style.display="block",t.style.visibility="visible",t.offsetHeight);const c=t.getBoundingClientRect(),f=window.getComputedStyle(t);let l=c.width;if(l<=0||isNaN(l)){const p=f.width;l=p?parseInt(p):400}l=Math.max(100,Math.min(l,400)),e&&(t.style.display="",t.style.visibility="");const r=t.getBoundingClientRect(),g=Math.min(r.width,r.height)||l;return t.width=g*h,t.height=g*h,s.setTransform(1,0,0,1,0,0),s.scale(h,h),{ctx:s,size:g,dpr:h}}function nt(t,s,h,e,c,f=0){t.beginPath();for(let l=0;l<=c;l++){const r=l*Math.PI*2/c+f,g=s+Math.cos(r)*e,p=h+Math.sin(r)*e;l===0?t.moveTo(g,p):t.lineTo(g,p)}t.stroke()}function it(t,s,h,e,c,f,l=0){t.beginPath();for(let r=0;r<=f*2;r++){const g=r*Math.PI/f+l,p=r%2===0?e:c,M=s+Math.cos(g)*p,v=h+Math.sin(g)*p;r===0?t.moveTo(M,v):t.lineTo(M,v)}t.closePath(),t.stroke()}function B(t,s,h,e,c,f=0){const l=c%6;if(l===0)t.beginPath(),t.arc(s,h,e,0,Math.PI*2),t.stroke();else if(l===1)t.beginPath(),t.save(),t.translate(s,h),t.rotate(f),t.rect(-e,-e,e*2,e*2),t.restore(),t.stroke();else if(l===2)t.beginPath(),t.save(),t.translate(s,h),t.rotate(f),t.moveTo(0,-e),t.lineTo(-e*.866,e*.5),t.lineTo(e*.866,e*.5),t.closePath(),t.restore(),t.stroke();else if(l===3)nt(t,s,h,e,6,f);else if(l===4){const r=e*.4;it(t,s,h,e,r,5,f)}else t.beginPath(),t.save(),t.translate(s,h),t.rotate(f),t.moveTo(0,-e),t.lineTo(e,0),t.lineTo(0,e),t.lineTo(-e,0),t.closePath(),t.restore(),t.stroke()}function st(t,s,h,e,c){t.clearRect(0,0,s,s),t.save();const f=s/2,l=s/2;t.translate(f,l);const r=2+c.symmetry%7,g=c.symmetry%360*Math.PI/180,p=c.color%360,M=50+c.color%30,v=35+c.color%20;t.strokeStyle=`hsl(${p}, ${M}%, ${v}%)`,t.lineWidth=.8+e[0]()*1.5;const d=s*(.35+e[1]()*.15),w=c.matrix%4;let T=null;if(w===1||w===3){const o=e[2]()*Math.PI*2,i=d*(.1+e[3]()*.3);T={x:Math.cos(o)*i,y:Math.sin(o)*i}}const k=[];if(w===2||w===3){const o=2+Math.floor(e[4]()*4);for(let i=0;i<o;i++){const n=e[(i+5)%e.length]()*Math.PI*2,a=d*(.1+e[(i+6)%e.length]()*.4);k.push({x:Math.cos(n)*a,y:Math.sin(n)*a})}}const V=e[5]()>.5,S=[];if(V){const o=1+Math.floor(e[6]()*3),i=[{x:-d*.8,y:-d*.8},{x:d*.8,y:-d*.8},{x:-d*.8,y:d*.8},{x:d*.8,y:d*.8}];for(let n=0;n<o;n++){const a=i[n%4],u=2+Math.floor(e[7]()*4);for(let m=0;m<u;m++){const b=(e[(n*10+m)%e.length]()-.5)*d*.15,L=(e[(n*10+m+1)%e.length]()-.5)*d*.15,X=1+e[(n*10+m+2)%e.length]()*3.5,Y=Math.floor(e[(n*10+m+3)%e.length]()*6),K=e[(n*10+m+4)%e.length]()*Math.PI*2;S.push({x:a.x+b,y:a.y+L,size:X,shape:Y,rotation:K})}}}const $=3+c.structure%8,O=[];for(let o=0;o<$;o++){const i=o*Math.PI*2/$+g,n=(e[o%e.length]()-.5)*.4,a=i+n,u=d*(.4+e[(o+2)%e.length]()*.5),m=1+e[(o+3)%e.length]()*4,b=Math.floor(e[(o+4)%e.length]()*6),L=e[(o+5)%e.length]()*Math.PI*2;O.push({x:Math.cos(a)*u,y:Math.sin(a)*u,size:m,shape:b,rotation:L})}const y=[];for(const o of O)for(let i=0;i<r;i++){const n=i*Math.PI*2/r,a=Math.cos(n),u=Math.sin(n);y.push({x:o.x*a-o.y*u,y:o.x*u+o.y*a,size:o.size,shape:o.shape,rotation:o.rotation+n})}const W=Math.floor(e[0]()*8),D=[];for(let o=0;o<W;o++){const i=e[(o+1)%e.length]()*Math.PI*2,n=d*(.2+e[(o+2)%e.length]()*.7),a=.8+e[(o+3)%e.length]()*3.5,u=Math.floor(e[(o+4)%e.length]()*6),m=e[(o+5)%e.length]()*Math.PI*2;D.push({x:Math.cos(i)*n,y:Math.sin(i)*n,size:a,shape:u,rotation:m})}const P=[...y,...S,...D];if(w===0||w===3){const o=1.5+e[0]()*3.5,i=Math.floor(e[1]()*6),n=e[2]()*Math.PI*2;B(t,0,0,o,i,n)}if(T){const o=1.5+e[1]()*2.5,i=Math.floor(e[2]()*6),n=e[3]()*Math.PI*2;B(t,T.x,T.y,o,i,n)}for(let o=0;o<k.length;o++){const i=k[o],n=1+e[(o+2)%e.length]()*2.5,a=Math.floor(e[(o+3)%e.length]()*6),u=e[(o+4)%e.length]()*Math.PI*2;B(t,i.x,i.y,n,a,u)}for(const o of P)B(t,o.x,o.y,o.size,o.shape,o.rotation);if(t.lineWidth=.8+e[3]()*1.2,w===0||w===3){const o=.3+e[4]()*.4;for(const i of P)e[5]()>o&&(t.beginPath(),t.moveTo(0,0),t.lineTo(i.x,i.y),t.stroke())}if(T){const o=.4+e[6]()*.3;for(const i of P)e[7]()>o&&(t.beginPath(),t.moveTo(T.x,T.y),t.lineTo(i.x,i.y),t.stroke())}for(let o=0;o<k.length;o++){const i=k[o],n=.5+e[(o+4)%e.length]()*.3,a=Math.floor(e[(o+5)%e.length]()*(P.length/2));for(let u=0;u<a;u++){const m=Math.floor(e[(o+u+6)%e.length]()*P.length),b=P[m];e[(o+u+7)%e.length]()>n&&(t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(b.x,b.y),t.stroke())}}const C=c.noise%4;if(C===0&&y.length>1)for(let o=0;o<y.length;o++){const i=(o+1)%y.length,n=y[o],a=y[i];e[o%e.length]()>.3&&(t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(a.x,a.y),t.stroke())}else if(C===1){if(y.length>2){const o=3+Math.floor(e[0]()*6),i=Math.max(1,Math.floor(y.length/o));for(let n=0;n<o;n++){const a=n*i%y.length,u=y[a];t.beginPath(),t.moveTo(0,0),t.lineTo(u.x,u.y),t.stroke()}for(let n=0;n<o;n++){const a=n*i%y.length,u=(n+1)*i%y.length,m=y[a],b=y[u];t.beginPath(),t.moveTo(m.x,m.y),t.lineTo(b.x,b.y),t.stroke()}}}else if(C===2){if(P.length>2&&(T||k.length>0)){const o=T||k[0],i=3+Math.floor(e[1]()*6),n=[];for(let a=0;a<i;a++){const u=Math.floor(e[(a+2)%e.length]()*P.length);n.push(P[u])}for(const a of n)t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(a.x,a.y),t.stroke();for(let a=0;a<n.length;a++){const u=(a+1)%n.length,m=n[a],b=n[u];t.beginPath(),t.moveTo(m.x,m.y),t.lineTo(b.x,b.y),t.stroke()}}}else for(let o=0;o<P.length;o++)if(e[o%e.length]()>.7){const i=Math.floor(e[(o+1)%e.length]()*P.length);if(i!==o){const n=P[o],a=P[i];t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(a.x,a.y),t.stroke()}}if(S.length>1){for(let o=0;o<S.length-1;o++)if(e[o%e.length]()>.6){const i=S[o],n=S[o+1];Math.sqrt((n.x-i.x)**2+(n.y-i.y)**2)<d*.5&&(t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(n.x,n.y),t.stroke())}}t.restore()}function lt(t){const s=document.createElement("a");s.download="sigil.png",s.href=t.toDataURL("image/png"),s.click()}function at(t){const s=document.createElement("a");s.download="sigil.jpg",s.href=t.toDataURL("image/jpeg",.95),s.click()}async function rt(t){const{jsPDF:s}=await z(async()=>{const{jsPDF:e}=await import("./jspdf.es.min.-A3OtRMP.js").then(c=>c.j);return{jsPDF:e}},[]),h=new s({orientation:"portrait",unit:"px",format:[t.width,t.height]});h.addImage(t.toDataURL("image/png"),"PNG",0,0,t.width,t.height),h.save("sigil.pdf")}const _=document.getElementById("continue-btn"),j=document.querySelector(".preface"),R=document.querySelector(".request"),F=document.getElementById("generate-btn"),U=document.getElementById("request-input"),I=document.getElementById("sigil-container"),E=document.getElementById("sigil-canvas"),H=document.getElementById("export-png-btn"),G=document.getElementById("export-jpeg-btn"),J=document.getElementById("export-pdf-btn"),q=document.getElementById("ascii-art"),A=document.getElementById("export-buttons-container");_&&j&&R&&_.addEventListener("click",()=>{j.style.opacity="0",j.style.pointerEvents="none",setTimeout(()=>{R.style.opacity="1",R.style.pointerEvents="auto"},250)});F&&U&&I&&E&&q&&R&&A&&F.addEventListener("click",async()=>{const t=U.value.trim();if(!t)return;const s=t.toLowerCase().replace(/\s+/g," ").trim(),h=await x(s),e=et(h),c=tt(h);I.style.display="flex",I.style.visibility="visible",I.style.opacity="0",I.offsetHeight,E.offsetHeight,await new Promise(l=>requestAnimationFrame(l)),await new Promise(l=>requestAnimationFrame(l));const f=ot(E);if(f){f.size>0&&st(f.ctx,f.size,f.dpr,c,e),q.style.opacity="0",q.style.pointerEvents="none",R.style.opacity="0",R.style.pointerEvents="none",document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur();const l=document.querySelector('meta[name="viewport"]');l&&l.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"),setTimeout(()=>{I.style.opacity="1",I.style.pointerEvents="auto",A.style.opacity="1",A.style.pointerEvents="auto",window.scrollTo({top:0,left:0,behavior:"instant"});const r=I.parentElement;r&&r.scrollIntoView({behavior:"instant",block:"start"}),setTimeout(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},100)},250)}});E&&H&&H.addEventListener("click",()=>lt(E));E&&G&&G.addEventListener("click",()=>at(E));E&&J&&J.addEventListener("click",()=>rt(E));export{z as _};
